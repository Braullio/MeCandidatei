<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MeCandidatei</title>
<style>
* { box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0079bf, #005a9e);
  margin: 0; padding: 20px; color: #fff; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
}

header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
h1 { margin: 0; font-size: 24px; font-weight: 600; }

#addGlobal, #supportBtn {
  background: #61bd4f; border: none; color: white; padding: 10px 18px;
  border-radius: 6px; font-size: 15px; cursor: pointer; transition: background 0.2s; font-weight: 600; margin-left: 10px;
}
#addGlobal:hover, #supportBtn:hover { background: #519839; }

#board { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; flex-grow: 1; }

.column {
  background: #ebecf0; border-radius: 8px; width: 280px; padding: 12px;
  display: flex; flex-direction: column; box-shadow: 0 2px 4px rgba(0,0,0,0.15); flex-shrink: 0;
}

.column h2 { font-size: 18px; font-weight: 600; margin: 0 0 12px 0; color: #172b4d; text-align: center; }

.card {
  background: #ffffff; border-radius: 8px; padding: 12px 14px; margin-bottom: 10px;
  cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  transition: transform 0.1s ease, box-shadow 0.2s ease;
  color: #172b4d; font-size: 15px; line-height: 1.4em;
  overflow: hidden;
}

.card:hover { transform: scale(1.03); box-shadow: 0 3px 8px rgba(0,0,0,0.25); }

.card-title { font-weight: 600; margin-bottom: 4px; }
.card-desc {
  font-size: 14px; color: #555; display: -webkit-box;
  -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;
}

/* Modal */
.modal {
  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 10;
}

.modal-content {
  background:#fff; color:#172b4d; border-radius:8px;
  width:95%; max-width:none; height:90%; padding:20px; overflow-y:auto;
  box-shadow:0 3px 10px rgba(0,0,0,0.3);
  display: flex; flex-direction: column;
}

.modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
.modal-header input {
  font-size: 22px; font-weight: 600; border: none; outline: none; width: 100%; color:#172b4d; background: transparent;
}
.close { cursor: pointer; font-size: 24px; color: #999; }
.close:hover { color:#000; }

textarea {
  width: 100%; min-height: 100px; border-radius: 6px; border: 1px solid #ccc;
  padding: 10px; margin-top: 8px; resize: vertical; font-family: inherit; font-size: 14px;
}

.modal-body { display: flex; gap: 20px; margin-top: 20px; flex:1; }
.left-column { flex: 2; display: flex; flex-direction: column; overflow-y: auto; }
.right-column { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }

.left-column h4, .right-column h4 { margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; color: #172b4d; }
.history-item, .comment {
  background: #f4f5f7; padding: 8px 10px; border-radius: 6px; margin-bottom: 8px; font-size: 14px;
  display: flex; justify-content: space-between; align-items: flex-start; word-wrap: break-word;
}
.history-item small, .comment small { display: block; color: #6b778c; font-size: 12px; }

.delete-btn { background: none; border: none; color: #a33; cursor: pointer; font-weight: bold; margin-left: 8px; }
#commentInput { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; margin-top: 10px; font-family: inherit; font-size: 14px; }
#addCommentBtn, #deleteCardBtn {
  margin-top: 8px; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px;
}
#addCommentBtn { background: #0079bf; }
#addCommentBtn:hover { background: #026aa7; }
#deleteCardBtn { background: #b04632; align-self: flex-end; }
#deleteCardBtn:hover { background: #933b2d; }

/* Modal do apoio */
#supportModal .modal-content {
  max-width: 400px; height: auto; padding: 20px;
}
#supportModal .modal-body img {
  width: 200px; height: 200px; margin-bottom: 20px;
}
</style>
</head>
<body>
<header>
  <h1>MeCandidatei</h1>
  <div>
    <button id="addGlobal">+ Nova Vaga</button>
    <button id="supportBtn" style="background: #F5E130;color: black;">Apoiar Projeto</button>
  </div>
</header>

<div id="board"></div>

<!-- Modal do Card -->
<div id="cardModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <input id="modalTitle" />
      <span class="close">&times;</span>
    </div>

    <div class="modal-body">
      <div class="left-column">
        <h4>DescriÃ§Ã£o</h4>
        <textarea id="cardDescription" placeholder="Detalhes da vaga..."></textarea>

        <button id="deleteCardBtn">Excluir Card</button>

        <div class="history">
          <h4>HistÃ³rico de MovimentaÃ§Ãµes</h4>
          <div id="historyList"></div>
        </div>
      </div>

      <div class="right-column">
        <div class="comments">
          <h4>ComentÃ¡rios</h4>
          <div id="commentsList"></div>
          <input id="commentInput" placeholder="Escreva um comentÃ¡rio..." />
          <button id="addCommentBtn">Adicionar ComentÃ¡rio</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Apoio (QR Code) -->
<div id="supportModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>FaÃ§a um Pix e me ajude ðŸ˜„</h3>
      <span class="close" id="closeSupport">&times;</span>
    </div>
    <div class="modal-body" style="flex-direction:column;align-items:center;justify-content:center;">
      <img src="./qrcode.png" alt="QR Code Pix">
      <p style="text-align:center; font-size:16px; color:#172b4d;">
        Se vocÃª fizer um Pix, prometo que vou sorrir muito e talvez atÃ© danÃ§ar um pouco ðŸ’ƒðŸ•º
      </p>
    </div>
  </div>
</div>

<script>
const board = document.getElementById("board");
const addGlobal = document.getElementById("addGlobal");
const supportBtn = document.getElementById("supportBtn");
const supportModal = document.getElementById("supportModal");
const closeSupport = document.getElementById("closeSupport");

const modal = document.getElementById("cardModal");
const closeModal = modal.querySelector(".close");
const modalTitle = document.getElementById("modalTitle");
const cardDescription = document.getElementById("cardDescription");
const commentsList = document.getElementById("commentsList");
const commentInput = document.getElementById("commentInput");
const addCommentBtn = document.getElementById("addCommentBtn");
const historyList = document.getElementById("historyList");
const deleteCardBtn = document.getElementById("deleteCardBtn");

let currentCard = null;

const defaultData = [
  { title: "Vagas", cards: [] },
  { title: "Candidatei", cards: [] },
  { title: "ReuniÃ£o com RH", cards: [] },
  { title: "ReuniÃ£o TÃ©cnica", cards: [] },
  { title: "Teste PrÃ¡tico", cards: [] },
  { title: "ConcluÃ­do", cards: [] }
];

function saveData() { localStorage.setItem("MeCandidateiData", JSON.stringify(columnsData)); }
function loadData() {
  const data = localStorage.getItem("MeCandidateiData");
  return data ? JSON.parse(data) : defaultData;
}

let columnsData = loadData();

function renderBoard() {
  board.innerHTML = "";
  columnsData.forEach((col, colIndex) => {
    const columnEl = document.createElement("div");
    columnEl.className = "column";
    columnEl.innerHTML = `<h2>${col.title}</h2>`;

    col.cards.forEach((card, cardIndex) => {
      const cardEl = document.createElement("div");
      cardEl.className = "card";
      cardEl.innerHTML = `<div class="card-title">${card.title}</div>
                          <div class="card-desc">${card.description || ""}</div>`;
      cardEl.draggable = true;

      cardEl.addEventListener("dragstart", e => {
        cardEl.classList.add("dragging");
        e.dataTransfer.setData("colIndex", colIndex);
        e.dataTransfer.setData("cardIndex", cardIndex);
      });
      cardEl.addEventListener("dragend", () => cardEl.classList.remove("dragging"));
      cardEl.addEventListener("click", () => openCardModal(colIndex, cardIndex));

      columnEl.appendChild(cardEl);
    });

    columnEl.addEventListener("dragover", e => e.preventDefault());
    columnEl.addEventListener("drop", e => {
      const fromCol = e.dataTransfer.getData("colIndex");
      const fromCard = e.dataTransfer.getData("cardIndex");
      const movedCard = columnsData[fromCol].cards.splice(fromCard, 1)[0];
      const date = new Date().toLocaleString("pt-BR");
      movedCard.history = movedCard.history || [];
      movedCard.history.push(`${date} - Movido para "${col.title}"`);
      col.cards.push(movedCard);
      saveData(); renderBoard();
    });

    board.appendChild(columnEl);
  });
}

// Criar nova vaga
addGlobal.onclick = () => {
  const vaga = prompt("Digite o nome da vaga:");
  if (!vaga) return;
  columnsData[0].cards.push({
    title: vaga,
    description: "",
    comments: [],
    history: [`${new Date().toLocaleString("pt-BR")} - Criado`]
  });
  saveData(); renderBoard();
};

// Modal Card
function openCardModal(colIndex, cardIndex) {
  currentCard = { colIndex, cardIndex };
  const card = columnsData[colIndex].cards[cardIndex];
  modalTitle.value = card.title;
  cardDescription.value = card.description || "";
  renderComments(card.comments);
  renderHistory(card.history || []);
  modal.style.display = "flex";
}

function renderComments(comments) {
  commentsList.innerHTML = "";
  comments.forEach((c, i) => {
    const el = document.createElement("div");
    el.className = "comment";
    el.innerHTML = `<div><p>${c.text}</p><small>${c.date}</small></div>`;
    const delBtn = document.createElement("button");
    delBtn.textContent = "âœ•";
    delBtn.className = "delete-btn";
    delBtn.onclick = () => deleteComment(i);
    el.appendChild(delBtn);
    commentsList.appendChild(el);
  });
}

function renderHistory(history) {
  historyList.innerHTML = "";
  history.slice().reverse().forEach(h => {
    const el = document.createElement("div");
    el.className = "history-item";
    el.innerHTML = `<p>${h}</p>`;
    historyList.appendChild(el);
  });
}

function deleteComment(index) {
  const card = columnsData[currentCard.colIndex].cards[currentCard.cardIndex];
  card.comments.splice(index, 1);
  saveData(); renderComments(card.comments);
}

// Fechar modal
closeModal.onclick = () => closeCardModal();
window.onclick = e => {
  if (e.target === modal) closeCardModal();
  if (e.target === supportModal) supportModal.style.display = "none";
};
function closeCardModal() { saveCardDetails(); modal.style.display = "none"; }

// Salvar card
function saveCardDetails() {
  if (!currentCard) return;
  const card = columnsData[currentCard.colIndex].cards[currentCard.cardIndex];
  card.title = modalTitle.value;
  card.description = cardDescription.value;
  saveData(); renderBoard();
}

// ComentÃ¡rio
addCommentBtn.onclick = () => {
  const text = commentInput.value.trim();
  if (!text) return;
  const card = columnsData[currentCard.colIndex].cards[currentCard.cardIndex];
  const date = new Date().toLocaleString("pt-BR");
  card.comments.push({ text, date });
  saveData(); renderComments(card.comments); commentInput.value = "";
};

// Excluir card com seguranÃ§a
deleteCardBtn.onclick = () => {
  if (!currentCard) return;
  const confirmDelete = confirm("Tem certeza que deseja excluir este card?");
  if (!confirmDelete) return;
  const { colIndex, cardIndex } = currentCard;
  modal.style.display = "none";
  columnsData[colIndex].cards.splice(cardIndex, 1);
  currentCard = null;

  saveData();
  renderBoard();
};


// Modal de apoio
supportBtn.onclick = () => supportModal.style.display = "flex";
closeSupport.onclick = () => supportModal.style.display = "none";

renderBoard();
</script>
</body>
</html>
